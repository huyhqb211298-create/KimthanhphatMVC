<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Danh sách sản phẩm</title>
    <link rel="stylesheet" th:href="@{/lib/fontawesome/css/all.min.css}">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">

</head>
<body>

<div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Danh sách sản phẩm</h3>
        <div class="d-flex gap-2">
            <!-- ✅ Nút thêm danh mục -->
            <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#categoryModal">
                <i class="fa fa-folder-plus"></i> Thêm danh mục
            </button>

            <!-- ✅ Nút thêm thương hiệu -->
            <button type="button" class="btn btn-info text-white" data-bs-toggle="modal" data-bs-target="#brandModal">
                <i class="fa fa-tags"></i> Thêm thương hiệu
            </button>
            <!-- ✅ Nút thêm loại sản phẩm -->
            <button type="button" class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#productTypeModal">
                <i class="fa fa-layer-group"></i> Thêm loại sản phẩm
            </button>


            <!-- ✅ Link sang trang thêm mới sản phẩm -->
            <a th:href="@{/admin/products/new}" class="btn btn-primary">
                <i class="fa fa-plus"></i> Thêm sản phẩm
            </a>
        </div>
    </div>

    <!-- ✅ Hiển thị thông báo nếu có -->
    <div th:if="${message}" class="alert alert-info" th:text="${message}"></div>

    <!-- ✅ Bảng danh sách sản phẩm -->
    <table class="table table-bordered align-middle">
        <thead class="table-light text-center">
        <tr>
            <th>Tên sản phẩm</th>
            <th>Giá</th>
            <th>Hiển thị giá</th>
            <th>Tình trạng hàng</th>
            <th>Danh mục</th>
            <th>Thương hiệu</th>
            <th style="width: 150px;">Hành động</th>
        </tr>
        </thead>
        <tbody class="align-middle">
        <tr th:each="p : ${products}">

            <!-- Tên -->
            <td th:text="${p.name}"></td>

            <!-- Giá -->
            <td th:text="${p.price != null ? #numbers.formatDecimal(p.price, 0, 'COMMA', 0, 'POINT') + '₫' : '—'}"></td>

            <!-- Hiển thị giá -->
            <td th:text="${p.priceDisplay != null ? p.priceDisplay.label : '—'}"></td>

            <!-- Tình trạng hàng -->
            <td>
                <span th:text="${p.stockStatus != null ? p.stockStatus.label : '—'}"
                      th:classappend="${p.stockStatus == T(com.example.kimthanhphatmvc.model.enums.StockStatus).IN_STOCK} ? 'badge bg-success' : 'badge bg-secondary'">
                </span>
            </td>

            <!-- Danh mục -->
            <td th:text="${p.category != null ? p.category.name : '—'}"></td>

            <!-- Thương hiệu -->
            <td th:text="${p.brand != null ? p.brand.name : '—'}"></td>


            <!-- Hành động -->
            <td class="text-center">
                <a th:href="@{'/admin/products/edit/' + ${p.id}}" class="btn btn-sm btn-warning">
                    <i class="fa fa-edit"></i> Sửa
                </a>
                <a th:href="@{'/admin/products/delete/' + ${p.id}}"
                   onclick="return confirm('Bạn chắc chắn muốn xoá sản phẩm này?');"
                   class="btn btn-sm btn-danger mt-1">
                    <i class="fa fa-trash"></i> Xoá
                </a>
            </td>
        </tr>
        </tbody>
    </table>

    <div th:if="${#lists.isEmpty(products)}" class="text-center text-muted mt-3">
        Không có sản phẩm nào.
    </div>
</div>

<!-- ✅ Modal thêm danh mục -->
<div class="modal fade" id="categoryModal" tabindex="-1" aria-labelledby="categoryModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form th:action="@{/admin/categories/save}" method="post">
                <div class="modal-header">
                    <h5 class="modal-title" id="categoryModalLabel">Thêm danh mục</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Đóng"></button>
                </div>
                <div class="modal-body">
                    <label for="categoryName" class="form-label">Tên danh mục</label>
                    <input type="text" id="categoryName" name="name" class="form-control" required>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                    <button type="submit" class="btn btn-success">Lưu</button>
                </div>
            </form>
        </div>
    </div>
</div>
<!-- ✅ Modal thêm loại sản phẩm -->
<div class="modal fade" id="productTypeModal" tabindex="-1" aria-labelledby="productTypeModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form th:action="@{/admin/product-types/save}" method="post">
                <div class="modal-header">
                    <h5 class="modal-title" id="productTypeModalLabel">Thêm loại sản phẩm</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Đóng"></button>
                </div>
                <div class="modal-body">
                    <label for="productTypeName" class="form-label">Tên loại sản phẩm</label>
                    <input type="text" id="productTypeName" name="name" class="form-control" required>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                    <button type="submit" class="btn btn-dark">Lưu</button>
                </div>
            </form>
        </div>
    </div>
</div>


<!-- ✅ Modal thêm thương hiệu -->
<div class="modal fade" id="brandModal" tabindex="-1" aria-labelledby="brandModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form th:action="@{/admin/brands/save}" method="post">
                <div class="modal-header">
                    <h5 class="modal-title" id="brandModalLabel">Thêm thương hiệu</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Đóng"></button>
                </div>
                <div class="modal-body">
                    <label for="brandName" class="form-label">Tên thương hiệu</label>
                    <input type="text" id="brandName" name="name" class="form-control" required>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                    <button type="submit" class="btn btn-info text-white">Lưu</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
<!-- ✅ Script kiểm tra modal -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        console.log('Bootstrap modals ready');
    });
</script>

</body>
</html>
